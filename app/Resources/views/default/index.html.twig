{% extends 'base.html.twig' %}

{% block body %}
    <div class="container">
        <h1>Reddit-Style App</h1>
        <table id="articleList" class="table">
            <tbody></tbody>
        </table>
        <button id="nextButton" class="btn btn-xs btn-primary">Next</button>
    </div>
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
{% endblock %}
{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script>
        var count = 25,
            lastArticleName;
        $(function() {
            callApi('api');
        });

        $(document).on('click', '#nextButton', function () {
            var uri = 'api' + '?count=' + count + '&after=' + lastArticleName;
            count += 25;
            callApi(uri);
        });

        function callApi(uri) {
            $.get(uri, function (data) {
                var articleTable = $('#articleList'),
                    currentRows = $('#articleList tr');
                currentRows.remove();
                $.each(data.collection, function (index, element) {
                    var html = '<tr><td>' + '<a href="' + element.link + '"><b>' + element.title + '</b></a></td></tr>';
                    articleTable.append(html);
                });
                lastArticleName = data.last_article_name;
            });
        }
    </script>
{% endblock %}
